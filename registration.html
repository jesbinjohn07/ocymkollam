<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kalamela Registration - OCYM Kollam</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-box">
    <img src="images/logo.png" class="logo">
    <h1>OCYM Kollam</h1>
    <p class="subtitle">Orthodox Christian Youth Movement</p>
    <p class="diocese">Kollam Diocese</p>
  </div>

  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="notice.html">Notice</a>
    <a href="registration.html" class="active">Registration</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<!-- FORM -->
<section class="form-section">
  <h2>üé≠ Kalamela Registration</h2>

  <form class="registration-form" id="regForm" onsubmit="onSubmit(event)">

    <!-- Basic Details -->
    <label>Full Name</label>
    <input id="fullName" type="text" placeholder="Enter your name" required>

    <label>Parish</label>
    <input id="parish" type="text" placeholder="Enter parish" required>

    <label>Position</label>
    <select id="position" required>
      <option value="">Select Position</option>
      <option>Secretary</option>
      <option>Vice President</option>
      <option>President</option>
      <option>Member</option>
    </select>

    <!-- ‚úÖ PHONE NUMBER ADDED PROPERLY -->
    <label>Phone Number</label>
    <input id="phone" type="tel" placeholder="Enter phone number" required pattern="[0-9]{10}">

    <hr>

    <!-- Item Registration -->
    <h3>üéØ Item Registration</h3>
    <div id="itemsContainer"></div>

    <div style="display:flex; gap:10px; margin-top:12px;">
      <button type="button" onclick="addItem()">‚ûï Add Item</button>
      <button type="button" onclick="clearItems()">üßπ Clear</button>
    </div>

    <button type="submit" style="margin-top:18px;">
      Submit Registration
    </button>
  </form>
</section>

<footer>
  <p>¬© 2026 OCYM Kollam | All Rights Reserved</p>
</footer>

<script>
/* ===== PROGRAM LIST ===== */
const programs = [
  { name: "‡¥≤‡¥≥‡¥ø‡¥§‡¥ó‡¥æ‡¥®‡¥Ç", count: 1 },
  { name: "‡¥∏‡¥Æ‡µÇ‡¥π‡¥ó‡¥æ‡¥®‡¥Ç", count: 3 },
  { name: "‡¥∏‡µã‡¥™‡µã‡¥ï‡¥∞‡¥£ ‡¥∏‡¥Æ‡µÇ‡¥π‡¥ó‡¥æ‡¥®‡¥Ç", count: 7 },
  { name: "‡¥™‡µç‡¥∞‡¥∏‡¥Ç‡¥ó‡¥Ç", count: 1 },
  { name: "‡¥ï‡¥•‡¥æ‡¥™‡µç‡¥∞‡¥∏‡¥Ç‡¥ó‡¥Ç", count: 1 },
  { name: "‡¥∏‡µç‡¥ü‡¥ø‡¥±‡¥ø‡¥Ç‡¥ó‡µç ‡¥á‡µª‡¥∏‡µç‡¥ü‡µç‡¥∞‡¥Æ‡µÜ‡µª‡µç‡¥±‡µç", count: 1 },
  { name: "‡¥ï‡µÄ‡¥¨‡µã‡µº‡¥°‡µç", count: 1 },
  { name: "‡¥§‡¥¨‡¥≤", count: 1 },
  { name: "‡¥â‡¥™‡¥®‡µç‡¥Ø‡¥æ‡¥∏‡¥Ç", count: 1 },
  { name: "‡¥ö‡¥ø‡¥§‡µç‡¥∞‡¥∞‡¥ö‡¥®", count: 1 },
  { name: "‡¥ï‡¥•‡¥æ‡¥∞‡¥ö‡¥®", count: 1 },
  { name: "‡¥ï‡¥µ‡¥ø‡¥§‡¥æ‡¥∞‡¥ö‡¥®", count: 1 },
  { name: "‡¥Æ‡¥æ‡µº‡¥ó‡¥Ç‡¥ï‡¥≥‡¥ø", count: 8 },
  { name: "‡¥™‡¥∞‡¥ø‡¥ö‡¥Æ‡µÅ‡¥ü‡µç‡¥ü‡µç ‡¥ï‡¥≥‡¥ø", count: 8 },
  { name: "‡¥§‡µÜ‡¥∞‡µÅ‡¥µ‡µç ‡¥®‡¥æ‡¥ü‡¥ï‡¥Ç", count: 10 },
  { name: "‡¥ï‡µç‡¥µ‡¥ø‡¥∏‡µç", count: 3 },
  { name: "‡¥Æ‡µà‡¥Ç", count: 7 }
];

/* ADD ITEM */
function addItem(){
  const container = document.getElementById('itemsContainer');

  let options = '<option value="">Select Program</option>';
  programs.forEach((p,idx)=>{
    options += `<option value="${idx}">${p.name} (${p.count})</option>`;
  });

  const div = document.createElement('div');
  div.className = 'item-block';
  div.innerHTML = `
    <label>Item Program</label>
    <select onchange="onProgramChange(this)" required>
      ${options}
    </select>

    <div class="participants"></div>

    <button type="button" onclick="removeItem(this)">‚ùå Remove</button>
  `;

  container.appendChild(div);
}

/* PROGRAM CHANGE */
function onProgramChange(selectEl){
  const idx = selectEl.value;
  const partsDiv = selectEl.parentElement.querySelector('.participants');
  partsDiv.innerHTML = "";

  if(!idx) return;

  // prevent duplicate selection
  const selected = Array.from(document.querySelectorAll('#itemsContainer select'))
    .map(s=>s.value);
  if(selected.filter(v=>v===idx).length > 1){
    alert("This item already selected!");
    selectEl.value="";
    return;
  }

  const n = programs[idx].count;
  for(let i=1;i<=n;i++){
    const inp = document.createElement('input');
    inp.type="text";
    inp.placeholder = `Participant ${i} Name`;
    inp.required = true;
    partsDiv.appendChild(inp);
  }
}

/* REMOVE ITEM */
function removeItem(btn){
  if(!confirm("Remove this item?")) return;
  btn.closest('.item-block').remove();
}

/* CLEAR */
function clearItems(){
  document.getElementById('itemsContainer').innerHTML="";
}

/* SUBMIT */
function onSubmit(e){
  e.preventDefault();

  const fullName = document.getElementById('fullName').value.trim();
  const parish = document.getElementById('parish').value.trim();
  const position = document.getElementById('position').value;
  const phone = document.getElementById('phone').value.trim();   // ‚úÖ NEW

  const blocks = Array.from(document.querySelectorAll('.item-block'));
  if(blocks.length===0){
    alert("Please add at least one item.");
    return;
  }

  const items = [];
  for(const b of blocks){
    const sel = b.querySelector('select');
    const idx = sel.value;
    if(!idx){ alert("Select program for all items"); return; }

    const names = Array.from(b.querySelectorAll('.participants input'))
      .map(i=>i.value.trim());
    if(names.some(n=>n==="")){
      alert("Fill all participant names");
      return;
    }

    items.push({
      program: programs[idx].name,
      participants: names.join(" | ")
    });
  }

  if(!confirm("Submit registration now?")) return;

  fetch("https://script.google.com/macros/s/AKfycbyf_DQeEJaUM2AeAzjmFPY3alip-nYTTwGq4gGI4BfUpmDW_IcYTt5Qxkcna-pFrSI7/exec", {
    method: "POST",
    body: JSON.stringify({
      fullName,
      parish,
      position,
      phone,     // ‚úÖ SENT TO SHEET
      items
    })
  })
  .then(res=>res.text())
  .then(()=>{
    alert("‚úÖ Registration submitted successfully!");
    document.getElementById('regForm').reset();
    clearItems();
  })
  .catch(()=>{
    alert("‚ùå Submission failed. Please check internet.");
  });
}
</script>

</body>
</html>
